# エージェント連携システムの仕様と課題

作成日: 2026-01-23
作成者: Sisyphus (PM)
対象: Antigravity（ユーザー）

---

## 📊 現状の仕組み

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Antigravity（ユーザー）                  │
│  - プロジェクトの監視                                       │
│  - 重要な意思決定                                           │
└──────────────────┬──────────────────────────────────────────┘
                   │ 連携: チャット/メッセージ
                   ▼
┌─────────────────────────────────────────────────────────────┐
│                  Sisyphus（PM）                            │
│  - 進捗管理                                               │
│  - タスク割り当て                                         │
│  - ブロッカー解決                                           │
│  - ドキュメント更新                                         │
└──────────────────┬──────────────────────────────────────────┘
                   │ 連携: チャット/メッセージ（手動）
                   ▼
┌─────────────────────────────────────────────────────────────┐
│              エージェントA/B/C（ターミナルエージェント）      │
│  - タスク実行                                             │
│  - 進捗報告                                               │
│  - 問題の報告                                             │
└─────────────────────────────────────────────────────────────┘
                   │ 連携: チャット/メッセージ（手動）
                   ▼
┌─────────────────────────────────────────────────────────────┐
│            ファイルシステム（ドキュメント）                   │
│  - PROGRESS_DASHBOARD.md                                  │
│  - AGENT_TASKS.md                                        │
│  - USER_DASHBOARD.md                                     │
└─────────────────────────────────────────────────────────────┘
```

### 連携の流れ

1. **PM（Sisyphus）**:
   - エージェントにタスクを割り当て（AGENT_TASKS.md）
   - ドキュメントを作成（PROGRESS_DASHBOARD.md, USER_DASHBOARD.md）

2. **エージェント（A/B/C）**:
   - タスクを実行
   - チャットで進捗を報告（手動）
   - 問題があればPMに報告

3. **PM（Sisyphus）**:
   - エージェントからの報告を受け取る
   - ドキュメントを手動で更新（PROGRESS_DASHBOARD.md, USER_DASHBOARD.md）

4. **ユーザー（Antigravity）**:
   - USER_DASHBOARD.md を確認
   - 必要な指示をPMに与える

---

## ⚠️ 現状の課題

### 課題1: 手動連携による遅延

**問題**:
- エージェントからの報告がチャットベース
- PMが手動でドキュメントを更新する必要がある
- リアルタイム性が低い

**影響**:
- ユーザーは最新の進捗をすぐに確認できない
- PMの作業負担が高い
- ドキュメントの更新漏れのリスク

### 課題2: ユーザー体験の欠如

**問題**:
- ユーザーは md ファイルを見る必要がある
- 視覚的なダッシュボードがない
- アラートや通知がない

**影響**:
- ユーザーが進捗を把握しにくい
- 重要なイベント（ブロッカー発生など）を見逃す可能性がある

### 課題3: エージェントの報告負担

**問題**:
- エージェントは毎回チャットで報告する必要がある
- テンプレートをコピーして記述する手間

**影響**:
- 報告漏れのリスク
- エージェントの生産性が低下する可能性

---

## 🔧 解決策の提案

### 解決策1: 自動化された進捗管理システム

**アーキテクチャ**:
```
┌─────────────────────────────────────────────────────────────┐
│                    Antigravity（ユーザー）                  │
│  - リアルタイムダッシュボード                                │
│  - アラート通知                                             │
└──────────────────┬──────────────────────────────────────────┘
                   │ WebSocket / API
                   ▼
┌─────────────────────────────────────────────────────────────┐
│                   進捗管理サーバー                         │
│  - エージェントからの進捗受信                               │
│  - リアルタイム更新                                         │
│  - イベント通知                                             │
└──────────────────┬──────────────────────────────────────────┘
                   │ WebSocket / API
                   ▼
┌─────────────────────────────────────────────────────────────┐
│              エージェントA/B/C                              │
│  - 進捗APIで報告                                           │
│  - 自動的に同期                                             │
└─────────────────────────────────────────────────────────────┘
```

**実装**:
```javascript
// エージェントからの進捗報告API
POST /api/progress/report
{
  "agent": "C",
  "taskId": "C-1",
  "action": "completed",
  "details": "TypeScriptエラーを修正しました"
}

// ユーザー向けリアルタイムダッシュボード
GET /api/progress/dashboard
// WebSocket: ws://localhost:3000/progress/stream
```

**メリット**:
- リアルタイム更新
- 自動化された同期
- ユーザー体験の向上

### 解決策2: 視覚的なダッシュボード

**実装**: Next.jsのページとして実装

```typescript
// app/dashboard/page.tsx
'use client';

import { useWebSocket } from '@/hooks/useWebSocket';

export default function Dashboard() {
  const { progress, agents, blockers } = useWebSocket();

  return (
    <div className="dashboard">
      <ProgressOverall progress={progress.overall} />
      <AgentGrid agents={agents} />
      <BlockerAlert blockers={blockers} />
    </div>
  );
}
```

**機能**:
- リアルタイム進捗表示
- エージェント別の状況
- アラート通知（ブロッカー発生時など）
- グラフによる可視化

### 解決策3: エージェントSDK

**実装**: エージェント用の軽量ライブラリ

```javascript
// エージェントが使用するSDK
import { AgentClient } from '@xboost/agent-sdk';

const agent = new AgentClient('C');

// タスク開始
await agent.startTask('C-1', 'TypeScript構文エラー修正');

// タスク完了
await agent.completeTask('C-1', {
  files: ['cta-checker/page.tsx'],
  verification: 'npm run typecheck passed'
});

// ブロッカー報告
await agent.reportBlocker({
  id: 'BLK-001',
  problem: 'openaiパッケージのインストールエラー',
  solution: '検討中'
});
```

**メリット**:
- エージェントの報告負担を軽減
- 型安全な進捗報告
- 自動的にドキュメント更新

---

## 📅 移行計画

### Phase 1: 簡易的な自動化（1〜2日）

1. **進捗管理APIの実装**
   - `/api/progress/report` - エージェントからの報告受信
   - `/api/progress/dashboard` - ダッシュボード用データ

2. **簡易的なダッシュボードUI**
   - Markdownから自動生成
   - Next.jsのページとして実装

### Phase 2: WebSocketによるリアルタイム更新（3〜5日）

1. **WebSocketサーバーの実装**
2. **リアルタイム更新機能**
3. **アラート通知**

### Phase 3: エージェントSDKの実装（1週間）

1. **SDKの開発**
2. **エージェントへの統合**
3. **テスト**

---

## 💡 即時的な改善策

完全なシステムを実装するまで、以下の改善策を提案します：

### 改善策1: PMによる定期更新

**手順**:
1. PM（Sisyphus）が1時間ごとに進捗を確認
2. USER_DASHBOARD.md を更新
3. ユーザーに最新の状態を通知

### 改善策2: 重要イベントの即時通知

**手順**:
1. エージェントから重要な報告（完了、ブロッカー）を受け取る
2. 即座にユーザーに通知

### 改善策3: ユーザー向け簡易ダッシュボード

**手順**:
1. USER_DASHBOARD.md を最新に保つ
2. 重要な情報を上部に配置
3. 視覚的な表現を追加（ASCIIアートなど）

---

## 📞 PMへのフィードバック

以下の点についてフィードバックをいただけると幸いです：

1. **現在の仕組みについて**:
   - どの画面を見ていますか？
   - 何が見にくいですか？
   - 何を追加したいですか？

2. **理想の連携方法**:
   - エージェントとどう連携したいですか？
   - どのような情報をリアルタイムで知りたいですか？
   - どのような通知が欲しいですか？

3. **優先順位**:
   - 今すぐ必要な機能は？
   - あると便利な機能は？

---

**作成日**: 2026-01-23
**PM**: Sisyphus
**最終更新**: 2026-01-23 17:00
